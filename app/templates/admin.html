<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Leads Cadastrados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header class="bg-dark text-white text-center py-4">
        <div class="container">
            <h1 class="display-6">Área Administrativa - Leads</h1>
        </div>
    </header>

    <main class="container my-5">
        <div class="row">
           <div class="container mt-4">
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Lista de Leads</h3>
        <button onclick="exportTableToCSV('leads_export.csv')" class="btn btn-success">
            <i class="fa fa-file-excel-o"></i> Baixar Excel/CSV
        </button>
    </div>

    <div class="table-responsive shadow-sm bg-white rounded">
        <table class="table table-striped table-hover mb-0" id="tabelaLeads">
            <thead class="table-dark">
                <tr>
                    <th>Nome</th>
                    <th>Sobrenome</th>
                    <th>Email</th>
                    <th>Telefone</th>
                    <th>Data de Nascimento</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in leads %}
                <tr>
                    <td>{{ lead.nome }}</td>
                    <td>{{ lead.sobrenome }}</td>
                    <td>{{ lead.email }}</td>
                    <td>{{ lead.telefone }}</td>
                    <td>
                        {% if lead.data_nascimento %}
                            {{ lead.data_nascimento.strftime('%d/%m/%Y') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
        </div>
    </main>

    <footer class="text-center py-4">
        <p>&copy; 2025 Parentalteen. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
function exportTableToCSV(filename) {
    var csv = [];
    var rows = document.querySelectorAll("table#tabelaLeads tr");

    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");

        for (var j = 0; j < cols.length; j++) {
            // Pega o texto e remove quebras de linha extras
            var data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, "").trim();
            // Coloca aspas se tiver vírgula no conteúdo para não quebrar a coluna
            row.push('"' + data + '"');
        }

        csv.push(row.join(";")); // Usa ponto e vírgula para separar (padrão Excel Brasil)
    }

    downloadCSV(csv.join("\n"), filename);
}

function downloadCSV(csv, filename) {
    var csvFile;
    var downloadLink;

    // Adiciona o BOM para o Excel reconhecer acentos (UTF-8)
    var BOM = "\uFEFF"; 
    csvFile = new Blob([BOM + csv], {type: "text/csv;charset=utf-8;"});

    downloadLink = document.createElement("a");
    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = "none";

    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
}
</script>
</body>
</html>
